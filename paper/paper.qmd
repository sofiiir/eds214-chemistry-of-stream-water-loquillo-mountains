---
title: "EDS-214 Reproducible Workflows: Hurricane Hugo Effects on Stream Chemistry"
format: html
execute:
  message: false
  warning: false
---

# Background
The course EDS-214 titled workflows and reproducibility Shaffer et al. published a study analyzing the effects of Hurricane Hugo on the watersheds of the Loquillo Mountain Watershed in Puerto Rico. In this repository, figure 3 from Schaffer et al.'s paper was reproduced as a real world example of data analysis that benefits from workflow organization and 
```{r}
#| warning: false
#| message: false
#| echo: false

#calling libraries
library(tidyverse)
library(here)
library(janitor)
library(patchwork)
library(zoo)
library(png)

#sourcing the moving average function for analysis of the data 
source(here("R", "moving-average-function.R"))
```


# Data
Data was downloaded from 
```{r}
#| echo: false
#read in data
watershed_data <- read_csv(here::here("outputs", "compiled_data.csv"))
```

# Methods
```{r}
#|eval: false
#calculating 9 day moving average using mutate and group by 
mov_avg_k <- watershed_data |> 
  group_by(sample_id) |> #group by sample sites
  #mutating to create a new column
  mutate(mov_avg_k = sapply(sample_date, #sapply to run on all of the data 
                            moving_average, 
                            sample_date = sample_date, 
                            nutrient_conc = k, 
                            win_size_wks = 9)) |> 
  #selecting for just necessary data to create a plot 
  select(sample_id, sample_date, k, mov_avg_k)

```

```{r}
#| echo: false
#read in moving average data sets
mov_avg_k <- read_csv(here::here("outputs", "mov_avg_k.csv"))
mov_avg_no3_n <- read_csv(here::here("outputs", "mov_avg_no3_n.csv"))
mov_avg_mg <- read_csv(here::here("outputs", "mov_avg_mg.csv"))
mov_avg_ca <- read_csv(here::here("outputs", "mov_avg_ca.csv"))
mov_avg_nh4_n <- read_csv(here::here("outputs", "mov_avg_nh4_n.csv"))
```

# Results
NEED TO FIGURE OUT HOW TO MAKE MY GRAPH APPEAR
```{r}
#| echo: false
#creating a hurricane line
hurricane <- as.Date("1989-09-18")

# ggplot of the moving  average k 
k_plot <- ggplot(data = mov_avg_k, 
                 aes(x = sample_date, 
                     y = mov_avg_k, 
                     linetype = sample_id)) +
  geom_line() +
  #adding vertical hurricane hugo line
  geom_vline(xintercept = hurricane, linetype = "dashed") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank()) +
  labs(title = "Hurricane Hugo Effects on Stream Chemistry",
       y = "K mg |-1")

# ggplot of the moving average NO3_N
no3_n_plot <- ggplot(data = mov_avg_no3_n, 
                     aes(x = sample_date, 
                         y = mov_avg_no3_n, 
                         linetype = sample_id)) +
  geom_line() +
  #adding vertical hurricane hugo line
  geom_vline(xintercept = hurricane, linetype = "dashed") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank()) +
  labs(y = "NO3-N ug |-1")

# ggplot of the moving average NO3_N
mg_plot <- ggplot(data = mov_avg_mg, 
                  aes(x = sample_date, 
                      y = mov_avg_mg, 
                      linetype = sample_id)) +
  geom_line() +
  #adding vertical hurricane hugo line
  geom_vline(xintercept = hurricane, linetype = "dashed") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank()) +
  labs(y = "Mg mg |-1")

# ggplot of the moving average NO3_N
ca_plot <- ggplot(data = mov_avg_ca, 
                  aes(x = sample_date, 
                      y = mov_avg_ca, 
                      linetype = sample_id)) +
  geom_line() +
  #adding vertical hurricane hugo line
  geom_vline(xintercept = hurricane, linetype = "dashed") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_blank()) +
  labs(y = "Ca mg |-1")

# ggplot of the moving average NH4_N
nh4_n_plot <- ggplot(data = mov_avg_nh4_n, 
                     aes(x = sample_date, 
                         y = mov_avg_nh4_n, 
                         linetype = sample_id)) +
  geom_line() +
  #adding vertical hurricane hugo line
  geom_vline(xintercept = hurricane, linetype = "dashed") +
  labs(x = "Years",
       y = "NH4-N ug |-1")

#compiling the data to create one graph with all of the required subgraphs
fig3 <- k_plot / no3_n_plot / mg_plot / ca_plot / nh4_n_plot +
 plot_layout(guides = 'collect')

#saving the the fig3 figure into the figs folder
ggsave(here::here("figs", "fig3.png"))

#displaying figure
fig3

#show graph in quarto doc
#source(here::here("R", "ggplotting.R"))


#ggsave(here::here("figs", "fig3.jpg"))

```

Figure 3. Concentrations of 9-week averages of potassium (k), nitrate-N, magnesium (mg), calcium (ca), and ammonium-N (Nh4-n) in four streams in the Loquillo Mountain Watershed before and after Hurricane Hugo.   The vertical lines indicate Hurricane Hugo, the event of study.